<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>4-Pillar Ayurvedic Assessment System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            min-height: 90vh;
        }

        .header {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
            min-height: 500px;
        }

        /* Page States */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Patient Record Form */
        .patient-record h2 {
            color: #2d3436;
            margin-bottom: 25px;
            font-size: 1.8em;
            text-align: center;
            border-bottom: 3px solid #74b9ff;
            padding-bottom: 15px;
        }

        .patient-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
            font-size: 15px;
        }

        .form-group input, .form-group textarea {
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.3s;
            font-family: inherit;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .required {
            color: #e74c3c;
        }

        /* Progress Navigation */
        .progress-nav {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 30px 0;
        }

        .progress-nav h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #2d3436;
        }

        .pillar-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .pillar-btn {
            padding: 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 16px;
            transition: all 0.3s;
            position: relative;
            text-align: center;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .pillar-btn .icon {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .pillar-btn.available {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            transform: translateY(0);
        }

        .pillar-btn.available:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,184,148,0.3);
        }

        .pillar-btn.completed {
            background: linear-gradient(135deg, #6c5ce7, #5a4fcf);
            color: white;
        }

        .pillar-btn.completed::after {
            content: '‚úì';
            position: absolute;
            top: 10px;
            right: 15px;
            background: #00b894;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .pillar-btn.locked {
            background: #ddd;
            color: #888;
            cursor: not-allowed;
        }

        .pillar-btn.locked::after {
            content: 'üîí';
            position: absolute;
            top: 10px;
            right: 15px;
        }

        /* Assessment Pages */
        .assessment-header {
            background: linear-gradient(135deg, #74b9ff, #0984e3);
            color: white;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 25px;
        }

        .assessment-header h3 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }

        .instructions {
            background: #e8f4fd;
            color: #2d3436;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            border-left: 5px solid #74b9ff;
            font-weight: 500;
        }

        /* Assessment Tables */
        .assessment-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .assessment-table th {
            background: linear-gradient(135deg, #2d3436, #636e72);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: 600;
        }

        .assessment-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 1px solid #dee2e6;
            vertical-align: middle;
        }

        .assessment-table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .parameter-cell {
            background: #e3f2fd !important;
            font-weight: 600;
            text-align: left !important;
            min-width: 150px;
        }

        .clickable-cell {
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 8px;
            margin: 2px;
            padding: 10px !important;
        }

        .clickable-cell:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .clickable-cell.selected {
            border: 3px solid #667eea;
            background: #e3f2fd !important;
            font-weight: bold;
            transform: scale(1.02);
        }

        /* Agni specific colors */
        .vishama { background: #fff3e0; }
        .tikshna { background: #ffebee; }
        .manda { background: #e8f5e8; }
        .sama { background: #e3f2fd; }

        /* Dosha specific colors */
        .vata-cell { background: #f3e5f5; }
        .pitta-cell { background: #ffecb3; }
        .kapha-cell { background: #e8f5e8; }

        /* Score Display */
        .score-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .score-card {
            background: linear-gradient(135deg, #a8edea, #fed6e3);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .score-card:hover {
            transform: translateY(-3px);
        }

        .score-card h4 {
            color: #2d3436;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .score-value {
            font-size: 2.2em;
            font-weight: bold;
            color: #667eea;
        }

        /* Results Section */
        .results-section {
            background: #f1f2f6;
            padding: 25px;
            border-radius: 12px;
            margin-top: 25px;
        }

        .results-section h4 {
            color: #2d3436;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .severity-indicator {
            display: inline-block;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            margin: 5px;
            font-size: 13px;
        }

        .normal { background: #00b894; color: white; }
        .mild { background: #fdcb6e; color: #2d3436; }
        .moderate { background: #e17055; color: white; }
        .severe { background: #d63031; color: white; }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #636e72, #2d3436);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff7675, #d63031);
            color: white;
        }

        .btn:disabled {
            background: #ddd;
            color: #999;
            cursor: not-allowed;
            transform: none;
        }

        /* Progress Bar */
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #00b894, #00a085);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Status Messages */
        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-weight: 500;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-info {
            background: #cce7ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .patient-form {
                grid-template-columns: 1fr;
            }
            
            .pillar-buttons {
                grid-template-columns: 1fr;
            }
            
            .nav-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .score-summary {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üè• 4 PILLAR CLINICAL ASSESSMENT MODEL (4-PCAM)</h1>
<p><strong>Developer Name:</strong> Dr. Smitrajsinh Jadeja, Dr. Anirudh Bhatt, Dr. Yogesh Valaki, Dr. Diksha Kanani</p>
<p><strong>Guided By:</strong> Dr. Prakash Kumbar</p>
        </div>

        <div class="content">
            <!-- MAIN PAGE: Patient Record Form -->
            <div id="main-page" class="page active">
                <div class="patient-record">
                    <h2>üìã PATIENT CASE RECORD</h2>
                    <div class="patient-form">
                        <div class="form-group">
                            <label>Patient Name <span class="required">*</span></label>
                            <input type="text" id="patientName" placeholder="Enter full name" required>
                        </div>
                        <div class="form-group">
                            <label>Age/Sex <span class="required">*</span></label>
                            <input type="text" id="ageSex" placeholder="e.g., 35/M or 28/F" required>
                        </div>
                        <div class="form-group">
                            <label>OPD No./IPD No.</label>
                            <input type="text" id="patientId" placeholder="Enter patient ID/number">
                        </div>
                        <div class="form-group">
                            <label>Date of Assessment</label>
                            <input type="date" id="assessmentDate">
                        </div>
                        <div class="form-group">
                            <label>Chief Complaints <span class="required">*</span></label>
                            <textarea id="complaints" placeholder="Describe main symptoms and duration" required></textarea>
                        </div>
                        <div class="form-group">
                            <label>Past History</label>
                            <textarea id="pastHistory" placeholder="Previous illnesses, surgeries, medications"></textarea>
                        </div>
                        <div class="form-group">
                            <label>Additional Points</label>
                            <textarea id="additionalPoints" placeholder="Family history, lifestyle, occupation, etc."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Referred By</label>
                            <input type="text" id="referredBy" placeholder="Doctor/Clinic name">
                        </div>
                    </div>

                    <div class="progress-nav">
                        <h3>üìä Assessment Progress</h3>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="pillar-buttons">
                            <button class="pillar-btn available" id="agni-btn" onclick="startAssessment('agni')">
                                <div class="icon">üî•</div>
                                <div>PILLAR 1: AGNI DUSTI</div>
                                <small>Digestive Fire Assessment</small>
                            </button>
                            <button class="pillar-btn locked" id="dosha-btn" onclick="startAssessment('dosha')">
                                <div class="icon">‚öñÔ∏è</div>
                                <div>PILLAR 2: DOSHA DUSTI</div>
                                <small>Constitutional Assessment</small>
                            </button>
                            <button class="pillar-btn locked" id="dhatu-btn" onclick="startAssessment('dhatu')">
                                <div class="icon">üß¨</div>
                                <div>PILLAR 3: DHATU DUSTI</div>
                                <small>Tissue Assessment</small>
                            </button>
                            <button class="pillar-btn locked" id="srotas-btn" onclick="startAssessment('srotas')">
                                <div class="icon">üåä</div>
                                <div>PILLAR 4: SROTO DUSTI</div>
                                <small>Channel Assessment</small>
                            </button>
                        </div>
                    </div>

                    <div id="completionStatus" class="status-message status-info" style="display: none;">
                        <strong>Assessment Status:</strong> Complete all 4 pillars to generate final report.
                    </div>
                </div>
            </div>

            <!-- PILLAR 1: AGNI DUSTI ASSESSMENT -->
            <div id="agni-page" class="page">
                <div class="assessment-header">
                    <h3>üî• PILLAR 1: AGNI DUSTI ASSESSMENT</h3>
                    <p>Based on types of Agni and classical lak·π£a·πáas from Charaka, Ashtanga Hridaya</p>
                </div>

                <div class="instructions">
                    <strong>üìã SCORING INSTRUCTIONS:</strong> Give 1 point for each symptom that matches a column (Vi·π£ama/Tƒ´k·π£·πáa/Manda/Sama). Click on the cell that best matches the patient's presentation for each parameter.
                </div>

                <table class="assessment-table">
                    <thead>
                        <tr>
                            <th style="width: 20%;">Parameter</th>
                            <th style="width: 20%;">Vi·π£ama Agni<br><small>(Vata Du·π£·π≠i)</small></th>
                            <th style="width: 20%;">Tƒ´k·π£·πáa Agni<br><small>(Pitta Du·π£·π≠i)</small></th>
                            <th style="width: 20%;">Manda Agni<br><small>(Kapha Du·π£·π≠i)</small></th>
                            <th style="width: 20%;">Sama Agni<br><small>(Balanced)</small></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="parameter-cell">1. Hunger</td>
                            <td class="clickable-cell vishama" data-pillar="agni" data-parameter="hunger" data-type="vishama">Irregular, unpredictable</td>
                            <td class="clickable-cell tikshna" data-pillar="agni" data-parameter="hunger" data-type="tikshna">Excessive, frequent hunger</td>
                            <td class="clickable-cell manda" data-pillar="agni" data-parameter="hunger" data-type="manda">Poor, delayed hunger</td>
                            <td class="clickable-cell sama" data-pillar="agni" data-parameter="hunger" data-type="sama">Timely, appropriate</td>
                        </tr>
                        <tr>
                            <td class="parameter-cell">2. Digestion Timing</td>
                            <td class="clickable-cell vishama" data-pillar="agni" data-parameter="digestion" data-type="vishama">Sometimes fast, sometimes slow</td>
                            <td class="clickable-cell tikshna" data-pillar="agni" data-parameter="digestion" data-type="tikshna">Very rapid digestion</td>
                            <td class="clickable-cell manda" data-pillar="agni" data-parameter="digestion" data-type="manda">Very slow, sluggish</td>
                            <td class="clickable-cell sama" data-pillar="agni" data-parameter="digestion" data-type="sama">Timely, comfortable</td>
                        </tr>
                        <tr>
                            <td class="parameter-cell">3. Stool Formation</td>
                            <td class="clickable-cell vishama" data-pillar="agni" data-parameter="stool" data-type="vishama">Alternate constipation & loose</td>
                            <td class="clickable-cell tikshna" data-pillar="agni" data-parameter="stool" data-type="tikshna">Frequent, loose, burning</td>
                            <td class="clickable-cell manda" data-pillar="agni" data-parameter="stool" data-type="manda">Constipated, sticky, mucoid</td>
                            <td class="clickable-cell sama" data-pillar="agni" data-parameter="stool" data-type="sama">Well-formed, once/day</td>
                        </tr>
                        <tr>
                            <td class="parameter-cell">4. Bloating/Discomfort</td>
                            <td class="clickable-cell vishama" data-pillar="agni" data-parameter="bloating" data-type="vishama">Gas, gurgling, erratic</td>
                            <td class="clickable-cell tikshna" data-pillar="agni" data-parameter="bloating" data-type="tikshna">Burning sensation</td>
                            <td class="clickable-cell manda" data-pillar="agni" data-parameter="bloating" data-type="manda">Heaviness, lethargy</td>
                            <td class="clickable-cell sama" data-pillar="agni" data-parameter="bloating" data-type="sama">No discomfort</td>
                        </tr>
                        <tr>
                            <td class="parameter-cell">5. Appetite Response</td>
                            <td class="clickable-cell vishama" data-pillar="agni" data-parameter="appetite" data-type="vishama">Becomes erratic</td>
                            <td class="clickable-cell tikshna" data-pillar="agni" data-parameter="appetite" data-type="tikshna">Becomes hungrier</td>
                            <td class="clickable-cell manda" data-pillar="agni" data-parameter="appetite" data-type="manda">Becomes duller</td>
                            <td class="clickable-cell sama" data-pillar="agni" data-parameter="appetite" data-type="sama">Stays steady</td>
                        </tr>
                        <tr>
                            <td class="parameter-cell">6. Tongue Coating</td>
                            <td class="clickable-cell vishama" data-pillar="agni" data-parameter="tongue" data-type="vishama">Variable, sometimes dry</td>
                            <td class="clickable-cell tikshna" data-pillar="agni" data-parameter="tongue" data-type="tikshna">Red, yellow tinge</td>
                            <td class="clickable-cell manda" data-pillar="agni" data-parameter="tongue" data-type="manda">Thick white coating</td>
                            <td class="clickable-cell sama" data-pillar="agni" data-parameter="tongue" data-type="sama">Clean</td>
                        </tr>
                        <tr>
                            <td class="parameter-cell">7. After Food Sensation</td>
                            <td class="clickable-cell vishama" data-pillar="agni" data-parameter="afterfood" data-type="vishama">Bloated or unsatisfied</td>
                            <td class="clickable-cell tikshna" data-pillar="agni" data-parameter="afterfood" data-type="tikshna">Hungry again quickly</td>
                            <td class="clickable-cell manda" data-pillar="agni" data-parameter="afterfood" data-type="manda">Heavy, sleepy</td>
                            <td class="clickable-cell sama" data-pillar="agni" data-parameter="afterfood" data-type="sama">Light and content</td>
                        </tr>
                        <tr>
                            <td class="parameter-cell">8. Weight Change</td>
                            <td class="clickable-cell vishama" data-pillar="agni" data-parameter="weight" data-type="vishama">Unpredictable</td>
                            <td class="clickable-cell tikshna" data-pillar="agni" data-parameter="weight" data-type="tikshna">Weight loss despite eating</td>
                            <td class="clickable-cell manda" data-pillar="agni" data-parameter="weight" data-type="manda">Weight gain despite eating</td>
                            <td class="clickable-cell sama" data-pillar="agni" data-parameter="weight" data-type="sama">Maintains weight</td>
                        </tr>
                    </tbody>
                </table>

                <div class="score-summary">
                    <div class="score-card">
                        <h4>Vi·π£ama Agni</h4>
                        <div class="score-value" id="agni-vishama-score">0</div>
                    </div>
                    <div class="score-card">
                        <h4>Tƒ´k·π£·πáa Agni</h4>
                        <div class="score-value" id="agni-tikshna-score">0</div>
                    </div>
                    <div class="score-card">
                        <h4>Manda Agni</h4>
                        <div class="score-value" id="agni-manda-score">0</div>
                    </div>
                    <div class="score-card">
                        <h4>Sama Agni</h4>
                        <div class="score-value" id="agni-sama-score">0</div>
                    </div>
                </div>

                <div class="results-section">
                    <h4>üìä Agni Assessment Results</h4>
                    <div id="agni-results">Complete the assessment to see results...</div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="goToMain()">‚Üê Back to Main</button>
                    <button class="btn btn-primary" id="agni-complete-btn" onclick="completeAssessment('agni')" disabled>Complete Assessment</button>
                </div>
            </div>

           <!-- PILLAR 2: DOSHA DUSTI ASSESSMENT -->
<div id="dosha-page" class="page">
  <div class="assessment-header">
    <h3>‚öñÔ∏è PILLAR 2: DOSHA DUSTI ASSESSMENT</h3>
    <p>Based on Classical Lak·π£a·πáas ‚Äì Caraka, Su≈õruta, VƒÅgbha·π≠a</p>
  </div>

  <div class="instructions">
    <strong>üìã SCORING INSTRUCTIONS:</strong> Score 0‚Äì2 per parameter (0 = Normal, 1 = Mild, 2 = Marked Abnormality). Max 20 points per dosha.
  </div>

  <!-- DOSHA TABLE -->
  <table class="assessment-table">
    <thead>
      <tr>
        <th>Parameter</th>
        <th>Vata Du·π£·π≠i</th>
        <th>Pitta Du·π£·π≠i</th>
        <th>Kapha Du·π£·π≠i</th>
        <th>NAD</th>

      </tr>
    </thead>
    <tbody>
      <tr>
        <td class="parameter-cell">1. Agni</td>
        <td class="clickable-cell vata-cell" data-dosha="vata" data-parameter="agni" data-score="2">Irregular, variable</td>
        <td class="clickable-cell pitta-cell" data-dosha="pitta" data-parameter="agni" data-score="2">Very sharp, frequent hunger</td>
        <td class="clickable-cell kapha-cell" data-dosha="kapha" data-parameter="agni" data-score="2">Poor appetite, slow digestion</td>
        <td class="clickable-cell nad-cell" data-dosha="nad" data-parameter="agni" data-score="0"></td>

      </tr>
      <tr>
        <td class="parameter-cell">2. Mala</td>
        <td class="clickable-cell vata-cell" data-dosha="vata" data-parameter="mala" data-score="2">Constipation, dry, scanty</td>
        <td class="clickable-cell pitta-cell" data-dosha="pitta" data-parameter="mala" data-score="2">Loose, yellowish, burning</td>
        <td class="clickable-cell kapha-cell" data-dosha="kapha" data-parameter="mala" data-score="2">Sticky, mucus-laden, sluggish</td>
<td class="clickable-cell nad-cell" data-dosha="nad" data-parameter="mala" data-score="0"></td>

      </tr>
      <tr>
        <td class="parameter-cell">3. Mutra</td>
        <td class="clickable-cell vata-cell" data-dosha="vata" data-parameter="mutra" data-score="2">Scanty, frequent, obstructed</td>
        <td class="clickable-cell pitta-cell" data-dosha="pitta" data-parameter="mutra" data-score="2">Yellow, burning</td>
        <td class="clickable-cell kapha-cell" data-dosha="kapha" data-parameter="mutra" data-score="2">Increased, cloudy</td>
<td class="clickable-cell nad-cell" data-dosha="nad" data-parameter="mutra" data-score="0"></td>

      </tr>
      <tr>
        <td class="parameter-cell">4. Sveda</td>
        <td class="clickable-cell vata-cell" data-dosha="vata" data-parameter="sveda" data-score="2">Dry skin, no sweat</td>
        <td class="clickable-cell pitta-cell" data-dosha="pitta" data-parameter="sveda" data-score="2">Excessive sweating, odor</td>
        <td class="clickable-cell kapha-cell" data-dosha="kapha" data-parameter="sveda" data-score="2">Cold, little sweat</td>
<td class="clickable-cell nad-cell" data-dosha="nad" data-parameter="sveda" data-score="0"></td>

      </tr>
      <tr>
        <td class="parameter-cell">5. Sparsha</td>
        <td class="clickable-cell vata-cell" data-dosha="vata" data-parameter="sparsha" data-score="2">Rough, dry, cold skin</td>
        <td class="clickable-cell pitta-cell" data-dosha="pitta" data-parameter="sparsha" data-score="2">Burning, warm, red skin</td>
        <td class="clickable-cell kapha-cell" data-dosha="kapha" data-parameter="sparsha" data-score="2">Thick, oily, cold skin</td>
<td class="clickable-cell nad-cell" data-dosha="nad" data-parameter="sparsha" data-score="0"></td>

      </tr>
      <tr>
        <td class="parameter-cell">6. BƒÅla/Ojas</td>
        <td class="clickable-cell vata-cell" data-dosha="vata" data-parameter="bala" data-score="2">Weakness, low endurance</td>
        <td class="clickable-cell pitta-cell" data-dosha="pitta" data-parameter="bala" data-score="2">Moderate stamina, irritability</td>
        <td class="clickable-cell kapha-cell" data-dosha="kapha" data-parameter="bala" data-score="2">Heavy, lazy, dull</td>
<td class="clickable-cell nad-cell" data-dosha="nad" data-parameter="bala" data-score="0"></td>

      </tr>
      <tr>
        <td class="parameter-cell">7. Manasika Bhava</td>
        <td class="clickable-cell vata-cell" data-dosha="vata" data-parameter="manasika" data-score="2">Anxiety, worry, fear</td>
        <td class="clickable-cell pitta-cell" data-dosha="pitta" data-parameter="manasika" data-score="2">Anger, short-tempered</td>
        <td class="clickable-cell kapha-cell" data-dosha="kapha" data-parameter="manasika" data-score="2">Dullness, depression, inertia</td>
<td class="clickable-cell nad-cell" data-dosha="nad" data-parameter="manasika" data-score="0"></td>

      </tr>
      <tr>
        <td class="parameter-cell">8. Gati/Bhrama</td>
        <td class="clickable-cell vata-cell" data-dosha="vata" data-parameter="gati" data-score="2">Fast, jerky, tremors</td>
        <td class="clickable-cell pitta-cell" data-dosha="pitta" data-parameter="gati" data-score="2">Sudden shifts, burning</td>
        <td class="clickable-cell kapha-cell" data-dosha="kapha" data-parameter="gati" data-score="2">Sluggish, slow, heaviness</td>
<td class="clickable-cell nad-cell" data-dosha="nad" data-parameter="gati" data-score="0"></td>

      </tr>
      <tr>
        <td class="parameter-cell">9. Roopam (External)</td>
        <td class="clickable-cell vata-cell" data-dosha="vata" data-parameter="roopam" data-score="2">Thin, dry, cracked</td>
        <td class="clickable-cell pitta-cell" data-dosha="pitta" data-parameter="roopam" data-score="2">Red, inflamed, acne</td>
        <td class="clickable-cell kapha-cell" data-dosha="kapha" data-parameter="roopam" data-score="2">Puffy, moist, oily</td>
<td class="clickable-cell nad-cell" data-dosha="nad" data-parameter="roopam" data-score="0"></td>

      </tr>
      <tr>
        <td class="parameter-cell">10. Jihva (Tongue)</td>
        <td class="clickable-cell vata-cell" data-dosha="vata" data-parameter="jihva" data-score="2">Dry, rough, blackish</td>
        <td class="clickable-cell pitta-cell" data-dosha="pitta" data-parameter="jihva" data-score="2">Red, yellow coat</td>
        <td class="clickable-cell kapha-cell" data-dosha="kapha" data-parameter="jihva" data-score="2">Thick, white coat</td>
<td class="clickable-cell nad-cell" data-dosha="nad" data-parameter="jihva" data-score="0"></td>

      </tr>
    </tbody>
  </table>

  <!-- SCORE CARDS -->
  <div class="score-summary">
    <div class="score-card">
      <h4>Vata Score</h4>
      <div class="score-value" id="vata-score">0</div>
    </div>
    <div class="score-card">
      <h4>Pitta Score</h4>
      <div class="score-value" id="pitta-score">0</div>
    </div>
    <div class="score-card">
      <h4>Kapha Score</h4>
      <div class="score-value" id="kapha-score">0</div>
    </div>
  </div>

  <!-- RESULTS -->
  <div class="results-section">
    <h4>üìä Dosha Assessment Results</h4>
    <div id="dosha-results">Please complete all parameters to view results...</div>
  </div>

  <!-- BUTTONS -->
  <div class="nav-buttons">
    <button class="btn btn-secondary" onclick="goToMain()">‚Üê Back to Main</button>
    <button class="btn btn-primary" id="dosha-complete-btn" onclick="completeAssessment('dosha')" disabled>Complete Assessment</button>
  </div>
</div>


            <!-- PILLAR 3: DHATU DUSTI ASSESSMENT -->
            <div id="dhatu-page" class="page">
                <div class="assessment-header">
                    <h3>üß¨ PILLAR 3: DHATU DUSTI ASSESSMENT</h3>
                    <p>Each dhƒÅtu assessed for classical signs of k·π£aya (depletion) and vriddhi (excess)</p>
                </div>

                <div class="instructions">
                    <strong>üìã SCORING INSTRUCTIONS:</strong> Score 0-2 per symptom (0=Normal, 1=Mild D≈´·π£·π≠i, 2=Mod/Severe D≈´·π£·π≠i). Assess for both K·π£aya and Vriddhi symptoms.
                </div>

                <div class="status-message status-info">
                    <strong>Coming Soon:</strong> Detailed assessment tables for all 7 Dhatus (Rasa, Rakta, Mamsa, Meda, Asthi, Majja, Shukra) will be available in the next update.
                </div>

                <div class="results-section">
                    <h4>üìä Dhatu Assessment Results</h4>
                    <div id="dhatu-results">Dhatu assessment framework ready for implementation...</div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="goToMain()">‚Üê Back to Main</button>
                    <button class="btn btn-primary" id="dhatu-complete-btn" onclick="completeAssessment('dhatu')">Mark as Complete (Temporary)</button>
                </div>
            </div>

            <!-- PILLAR 4: SROTO DUSTI ASSESSMENT -->
            <div id="srotas-page" class="page">
                <div class="assessment-header">
                    <h3>üåä PILLAR 4: SROTO DUSTI ASSESSMENT</h3>
                    <p>Each srotas evaluated based on classical lakshanas of dushti</p>
                </div>

                <div class="instructions">
                    <strong>üìã SCORING INSTRUCTIONS:</strong> Score 0-2 per symptom (0=Absent/Normal, 1=Mild, 2=Severe). Each srotas has specific symptoms to assess.
                </div>

                <div class="status-message status-info">
                    <strong>Coming Soon:</strong> Detailed assessment tables for all 9 Srotas (Annavaha, Rasavaha, Raktavaha, etc.) will be available in the next update.
                </div>

                <div class="results-section">
                    <h4>üìä Srotas Assessment Results</h4>
                    <div id="srotas-results">Srotas assessment framework ready for implementation...</div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="goToMain()">‚Üê Back to Main</button>
                    <button class="btn btn-primary" id="srotas-complete-btn" onclick="completeAssessment('srotas')">Mark as Complete (Temporary)</button>
                </div>
            </div>

            <!-- FINAL REPORT PAGE -->
            <div id="report-page" class="page">
                <div class="assessment-header">
                    <h3>üìã COMPREHENSIVE ASSESSMENT REPORT</h3>
                    <p>Complete analysis of all 4 pillars</p>
                </div>

                <div id="final-report-content">
                    <div class="status-message status-success">
                        <strong>Assessment Complete!</strong> All 4 pillars have been evaluated. Review the comprehensive report below.
                    </div>
                    
                    <div class="results-section">
                        <h4>üìä Summary Results</h4>
                        <div id="summary-results">Generate final report...</div>
                    </div>
                </div>

                <div class="nav-buttons">
                    <button class="btn btn-secondary" onclick="goToMain()">‚Üê Back to Main</button>
                    <button class="btn btn-primary" onclick="printFinalReport()">üñ®Ô∏è Print Report</button>
                    <button class="btn btn-danger" onclick="resetAllAssessments()">üîÑ Reset All</button>
                </div>
            </div>
        </div>
    </div>

<script>
/* ===========================
   4-PILLAR ASSESSMENT SCRIPT
   Full script: Agni (unchanged) + Dosha (enhanced with severity buttons)
   =========================== */

/* Global data storage (kept as in your original script, with selections etc.) */
let assessmentData = {
    patient: {},
    agni: { vishama: 0, tikshna: 0, manda: 0, sama: 0 },
    dosha: { vata: 0, pitta: 0, kapha: 0 },
    dhatu: {},
    srotas: {},
    selections: {},
    completed: { agni: false, dosha: false, dhatu: false, srotas: false }
};

// Initialize the application when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Set today's date (if element exists)
    const dateEl = document.getElementById('assessmentDate');
    if (dateEl) dateEl.valueAsDate = new Date();
    
    // Add event listeners to all clickable cells (agni + others)
    document.querySelectorAll('.clickable-cell').forEach(cell => {
        // For Agni cells we use existing dataset attributes
        cell.addEventListener('click', function() {
            handleCellClick(this);
        });
    });

    // Inject severity buttons for Dosha cells (so we don't have to change HTML)
    injectDoshaSeverityButtons();

    // Add form validation listeners (if form fields exist)
    const pn = document.getElementById('patientName');
    const as = document.getElementById('ageSex');
    const comp = document.getElementById('complaints');
    if (pn) pn.addEventListener('input', validateForm);
    if (as) as.addEventListener('input', validateForm);
    if (comp) comp.addEventListener('input', validateForm);
    
    // Restore autosaved data if present
    restoreAutoSaved();

    // Restore visual selections if any (in case import/autosave loaded data before injection)
    restoreSelections();

    updateProgress();
});

// -------------------- Validation --------------------
function validateForm() {
    const nameEl = document.getElementById('patientName');
    const ageEl = document.getElementById('ageSex');
    const compEl = document.getElementById('complaints');
    const name = nameEl ? nameEl.value.trim() : '';
    const ageSex = ageEl ? ageEl.value.trim() : '';
    const complaints = compEl ? compEl.value.trim() : '';
    
    const isValid = name && ageSex && complaints;
    
    // Enable/disable first pillar based on form completion
    const agniBtn = document.getElementById('agni-btn');
    if (agniBtn) {
        if (isValid) {
            agniBtn.classList.remove('locked');
            agniBtn.classList.add('available');
        } else {
            agniBtn.classList.add('locked');
            agniBtn.classList.remove('available');
        }
    }
}

// -------------------- Page navigation --------------------
function showPage(pageId) {
    // Hide all pages
    document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
    });
    
    // Show selected page (pageId may already be like 'agni-page' or 'agni' depending)
    const el = document.getElementById(pageId + '-page') || document.getElementById(pageId);
    if (el) el.classList.add('active');
}

function goToMain() {
    showPage('main');
    updateProgress();
}

// Assessment navigation (keeps existing validation)
function startAssessment(pillar) {
    // Validate form for first assessment
    if (pillar === 'agni') {
        const name = (document.getElementById('patientName') || {value: ''}).value.trim();
        const ageSex = (document.getElementById('ageSex') || {value: ''}).value.trim();
        const complaints = (document.getElementById('complaints') || {value: ''}).value.trim();
        
        if (!name || !ageSex || !complaints) {
            alert('Please fill in all required fields (Name, Age/Sex, Chief Complaints) before starting the assessment.');
            return;
        }
    }
    
    // Check if pillar is available (locked/available class)
    const btn = document.getElementById(pillar + '-btn');
    if (btn && btn.classList.contains('locked')) {
        alert('Complete the previous assessments first to unlock this pillar.');
        return;
    }
    
    showPage(pillar);
}

// Central cell click handler
function handleCellClick(cell) {
    const pillar = cell.dataset.pillar;
    const parameter = cell.dataset.parameter;
    
    if (pillar === 'agni') {
        handleAgniClick(cell, parameter);
    } else if (pillar === 'dosha') {
        // Dosha handled via severity buttons; clicking whole cell will do nothing except focus
        // but keep for backward compatibility
    }
    // dhatu/srotas handled separately later
}

// -------------------- AGNI assessment handlers (unchanged logic) --------------------
function handleAgniClick(cell, parameter) {
    const type = cell.dataset.type;
    
    // Remove previous selection for this parameter
    document.querySelectorAll(`[data-pillar="agni"][data-parameter="${parameter}"]`).forEach(c => {
        c.classList.remove('selected');
    });
    
    // Add selection to clicked cell
    cell.classList.add('selected');
    
    // Update scores
    updateAgniScores(parameter, type);
    
    // Check if assessment is complete (all 8 parameters selected)
    checkAgniCompletion();
}

function updateAgniScores(parameter, selectedType) {
    // Remove previous score for this parameter
    if (assessmentData.selections['agni_' + parameter]) {
        const prevType = assessmentData.selections['agni_' + parameter];
        assessmentData.agni[prevType]--;
    }
    
    // Add new score
    assessmentData.agni[selectedType]++;
    assessmentData.selections['agni_' + parameter] = selectedType;
    
    // Update display
    updateAgniDisplay();
}

function updateAgniDisplay() {
    // Update score cards
    document.getElementById('agni-vishama-score').textContent = assessmentData.agni.vishama;
    document.getElementById('agni-tikshna-score').textContent = assessmentData.agni.tikshna;
    document.getElementById('agni-manda-score').textContent = assessmentData.agni.manda;
    document.getElementById('agni-sama-score').textContent = assessmentData.agni.sama;

    // Calculate total dusti score
    const totalDustiScore = assessmentData.agni.vishama + assessmentData.agni.tikshna + assessmentData.agni.manda;
    
    // Determine severity
    let severity, severityClass, clinicalRisk = '';
    if (totalDustiScore === 0 && assessmentData.agni.sama > 0) {
        severity = 'SAMA AGNI (Balanced)';
        severityClass = 'normal';
        clinicalRisk = 'Ideal digestion, proper dhatu nourishment, immunity';
    } else if (totalDustiScore >= 1 && totalDustiScore <= 4) {
        severity = 'MILD AGNI DUSTI';
        severityClass = 'mild';
    } else if (totalDustiScore >= 5 && totalDustiScore <= 6) {
        severity = 'MODERATE AGNI DUSTI';
        severityClass = 'moderate';
    } else if (totalDustiScore >= 7) {
        severity = 'SEVERE AGNI DUSTI';
        severityClass = 'severe';
    } else {
        severity = 'Assessment in progress...';
        severityClass = 'mild';
    }

    // Find dominant agni type
    let dominantType = '';
    let maxScore = 0;
    Object.keys(assessmentData.agni).forEach(type => {
        if (assessmentData.agni[type] > maxScore) {
            maxScore = assessmentData.agni[type];
            dominantType = type;
        }
    });

    // Set clinical risks based on dominant type
    const risks = {
        vishama: 'IBS, flatulence, irregular metabolism, anxiety (Vata dominance)',
        tikshna: 'Hyperacidity, ulcers, gastritis, inflammation (Pitta dominance)',
        manda: 'Ama formation, metabolic sluggishness, weight gain (Kapha dominance)',
        sama: 'Ideal digestion, proper dhatu nourishment, immunity (Tridosha Balance)'
    };

    if (maxScore > 0) {
        clinicalRisk = risks[dominantType];
    }

    // Update results display (styled similar to previous version)
    const resultsHTML = `
        <p><strong>Total Dusti Score:</strong> ${totalDustiScore}/8</p>
        <p><strong>Severity:</strong> <span class="severity-indicator ${severityClass}">${severity}</span></p>
        ${maxScore > 0 ? `<p><strong>Dominant Pattern:</strong> ${dominantType.charAt(0).toUpperCase() + dominantType.slice(1)} Agni (Score: ${maxScore})</p>` : ''}
        <p><strong>Clinical Risk:</strong> ${clinicalRisk}</p>
    `;
    
    const agniResultsEl = document.getElementById('agni-results');
    if (agniResultsEl) agniResultsEl.innerHTML = resultsHTML;
}

function checkAgniCompletion() {
    const agniParameters = ['hunger', 'digestion', 'stool', 'bloating', 'appetite', 'tongue', 'afterfood', 'weight'];
    const selectedCount = agniParameters.filter(param => assessmentData.selections['agni_' + param]).length;
    
    const completeBtn = document.getElementById('agni-complete-btn');
    if (completeBtn) {
        if (selectedCount === 8) {
            completeBtn.disabled = false;
            completeBtn.style.background = 'linear-gradient(135deg, #00b894, #00a085)';
        } else {
            completeBtn.disabled = true;
            completeBtn.style.background = '#ddd';
        }
    }
    
    // Update progress text
    const agniResultsEl = document.getElementById('agni-results');
    if (agniResultsEl) {
        if (selectedCount < 8) {
            agniResultsEl.innerHTML = `
                <p><strong>Progress:</strong> ${selectedCount}/8 parameters assessed</p>
                <p><em>Please complete all parameters to see detailed results.</em></p>
            `;
        }
    }
}

// -------------------- DOSHA DUSTI (ENHANCED) --------------------
/*
  New approach:
  - Do not change HTML table.
  - Inject 3 severity buttons (0/1/2) into each cell that has data-dosha attribute.
  - When user clicks a button: store choice in assessmentData.selections using key format:
        dosha_<dosha>_<parameter> = <0|1|2>
    and update assessmentData.dosha[dosha] accordingly.
  - Visual cues: selected button gets .severity-selected, whole cell gets .selected (so CSS already styles .selected).
  - Enable Complete button when all 30 parameters have a selection (10 per dosha).
*/

function injectDoshaSeverityButtons() {
    const doshaCells = document.querySelectorAll('[data-dosha]');
    doshaCells.forEach(td => {
        if (td.querySelector('.dosha-severity-controls')) return;

        const controls = document.createElement('div');
        controls.className = 'dosha-severity-controls';
        controls.style.display = 'flex';
        controls.style.justifyContent = 'center';
        controls.style.gap = '6px';
        controls.style.marginTop = '8px';

        // If NAD column ‚Üí only one 0 button (green)
        if (td.dataset.dosha === 'nad') {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'dosha-severity-btn';
            btn.dataset.score = '0';
            btn.textContent = '0';
            btn.style.background = '#a8e6a3'; // light green
            btn.style.color = '#333';
            btn.style.border = 'none';
            btn.style.padding = '6px 8px';
            btn.style.borderRadius = '6px';
            btn.style.fontWeight = '600';
            btn.style.cursor = 'pointer';
            btn.style.minWidth = '36px';
            btn.style.boxShadow = '0 2px 6px rgba(0,0,0,0.08)';

            btn.addEventListener('click', e => {
                e.stopPropagation();
                handleDoshaSeverityClick(td, btn);
            });
            controls.appendChild(btn);
        } else {
            // Original code, but now only 1 and 2 buttons
            [1, 2].forEach(scoreVal => {
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'dosha-severity-btn';
                btn.dataset.score = String(scoreVal);
                btn.textContent = scoreVal;
                btn.style.border = 'none';
                btn.style.padding = '6px 8px';
                btn.style.borderRadius = '6px';
                btn.style.fontWeight = '600';
                btn.style.cursor = 'pointer';
                btn.style.minWidth = '36px';
                btn.style.boxShadow = '0 2px 6px rgba(0,0,0,0.08)';

                if (scoreVal === 1) {
                    btn.style.background = '#fde68a';
                    btn.style.color = '#333';
                    btn.title = '1 - Mild';
                } else if (scoreVal === 2) {
                    btn.style.background = '#ff8a80';
                    btn.style.color = '#333';
                    btn.title = '2 - Marked';
                }

                btn.addEventListener('click', e => {
                    e.stopPropagation();
                    handleDoshaSeverityClick(td, btn);
                });
                controls.appendChild(btn);
            });
        }
        td.appendChild(controls);
        td.style.paddingBottom = '14px';
    });
}

function handleDoshaSeverityClick(tdCell, btn) {
    const dosha = tdCell.getAttribute('data-dosha');
    const parameter = tdCell.getAttribute('data-parameter');
    const score = parseInt(btn.dataset.score);
    const selectionKey = `dosha_${dosha}_${parameter}`;

    if (!dosha || !parameter || isNaN(score)) return;

    // Check if clicking the same already selected button ‚Üí deselect
    const alreadySelected = btn.classList.contains('severity-selected');
    if (alreadySelected) {
        // Remove highlight
        btn.classList.remove('severity-selected');
        btn.style.outline = 'none';
        tdCell.classList.remove('selected');

        // Remove score from totals if Vata/Pitta/Kapha
        if (dosha !== 'nad' && assessmentData.selections[selectionKey] !== undefined) {
            const prev = parseInt(assessmentData.selections[selectionKey]);
            if (!isNaN(prev)) {
                assessmentData.dosha[dosha] -= prev;
            }
        }

        // Delete selection from storage
        delete assessmentData.selections[selectionKey];

        // Update display & completion
        updateDoshaDisplay();
        checkDoshaCompletion();
        startAutoSave();
        return; // End here for deselection
    }

    // --- Normal selection process ---
    // Deselect other buttons in this cell
    tdCell.querySelectorAll('.dosha-severity-btn').forEach(b => {
        b.classList.remove('severity-selected');
        b.style.outline = 'none';
        b.style.opacity = '0.9';
    });

    // Mark clicked button
    btn.classList.add('severity-selected');
    btn.style.outline = '3px solid rgba(102,126,234,0.25)';
    btn.style.opacity = '1';
    tdCell.classList.add('selected');

    if (dosha !== 'nad') {
        // Remove previous score from totals
        if (assessmentData.selections[selectionKey] !== undefined) {
            const prev = parseInt(assessmentData.selections[selectionKey]);
            if (!isNaN(prev)) {
                assessmentData.dosha[dosha] -= prev;
            }
        }
        // Store and count only Vata/Pitta/Kapha scores
        assessmentData.selections[selectionKey] = score;
        assessmentData.dosha[dosha] = (assessmentData.dosha[dosha] || 0) + score;
    } else {
        // NAD ‚Äî store selection but don't count in totals
        assessmentData.selections[selectionKey] = score;
    }

    // Update display & completion
    updateDoshaDisplay();
    checkDoshaCompletion();
    startAutoSave();
}
function updateDoshaDisplay() {
    // update numeric score cards
    const vEl = document.getElementById('vata-score');
    const pEl = document.getElementById('pitta-score');
    const kEl = document.getElementById('kapha-score');

    if (vEl) vEl.textContent = assessmentData.dosha.vata || 0;
    if (pEl) pEl.textContent = assessmentData.dosha.pitta || 0;
    if (kEl) kEl.textContent = assessmentData.dosha.kapha || 0;

    // severity interpreter function
    function getDoshaSeverity(score) {
        if (score >= 0 && score <= 4) return { text: 'No significant dushti', class: 'normal' };
        if (score >= 5 && score <= 9) return { text: 'Mild dushti', class: 'mild' };
        if (score >= 10 && score <= 14) return { text: 'Moderate dushti', class: 'moderate' };
        if (score >= 15 && score <= 20) return { text: 'Severe dushti', class: 'severe' };
        return { text: 'Assessment incomplete', class: 'mild' };
    }

    const vScore = assessmentData.dosha.vata || 0;
    const pScore = assessmentData.dosha.pitta || 0;
    const kScore = assessmentData.dosha.kapha || 0;

    const vSeverity = getDoshaSeverity(vScore);
    const pSeverity = getDoshaSeverity(pScore);
    const kSeverity = getDoshaSeverity(kScore);

    // determine dominant dosha
    let dominant = 'Balanced';
    let maxScore = Math.max(vScore, pScore, kScore);
    if (maxScore === vScore && maxScore > 0) dominant = 'Vata D≈´·π£·π≠i Dominant';
    else if (maxScore === pScore && maxScore > 0) dominant = 'Pitta D≈´·π£·π≠i Dominant';
    else if (maxScore === kScore && maxScore > 0) dominant = 'Kapha D≈´·π£·π≠i Dominant';

    // Build results HTML with colored badges (re-using classes .normal,.mild,.moderate,.severe)
    const resultsHTML = `
        <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-bottom:12px;">
            <div><strong>Vata:</strong> ${vScore}/20<br><span class="severity-indicator ${vSeverity.class}">${vSeverity.text}</span></div>
            <div><strong>Pitta:</strong> ${pScore}/20<br><span class="severity-indicator ${pSeverity.class}">${pSeverity.text}</span></div>
            <div><strong>Kapha:</strong> ${kScore}/20<br><span class="severity-indicator ${kSeverity.class}">${kSeverity.text}</span></div>
        </div>
        <p><strong>Dominant Dosha:</strong> ${dominant}</p>
    `;

    const doshaResultsEl = document.getElementById('dosha-results');
    if (doshaResultsEl) doshaResultsEl.innerHTML = resultsHTML;
}

function checkDoshaCompletion() {
    // All parameter names for the rows
    const parameters = ['agni','mala','mutra','sveda','sparsha','bala','manasika','gati','roopam','jihva'];

    // Count completed rows (at least one selection per row, NAD included)
    let completedRows = 0;
    parameters.forEach(param => {
        if (
            assessmentData.selections[`dosha_vata_${param}`] !== undefined ||
            assessmentData.selections[`dosha_pitta_${param}`] !== undefined ||
            assessmentData.selections[`dosha_kapha_${param}`] !== undefined ||
            assessmentData.selections[`dosha_nad_${param}`] !== undefined
        ) {
            completedRows++;
        }
    });

    const completeBtn = document.getElementById('dosha-complete-btn');

    // If all 10 rows have at least one selection, allow completion
    if (completedRows === parameters.length) {
        if (completeBtn) {
            completeBtn.disabled = false;
            completeBtn.style.background = 'linear-gradient(135deg, #00b894, #00a085)';
        }
    } else {
        if (completeBtn) {
            completeBtn.disabled = true;
            completeBtn.style.background = '#ddd';
        }
    }

    // Progress feedback for user
    const doshaResultsEl = document.getElementById('dosha-results');
    if (doshaResultsEl && completedRows < parameters.length) {
        doshaResultsEl.innerHTML = `
            <p><strong>Progress:</strong> ${completedRows}/10 rows completed</p>
            <p><em>Please make at least one selection in each row to complete the assessment.</em></p>
        `;
    } else {
        updateDoshaDisplay();
    }
}

// -------------------- Assessment completion (unchanged integration) --------------------
function completeAssessment(pillar) {
    // Save patient data
    savePatientData();
    
    // Mark pillar as completed
    assessmentData.completed[pillar] = true;
    
    // Update button states
    updatePillarButtons();
    
    // Show success message
    alert(`${pillar.toUpperCase()} assessment completed successfully!`);
    
    // Return to main page
    goToMain();
    
    // Check if all assessments are complete
    checkAllComplete();
}

function savePatientData() {
    assessmentData.patient = {
        name: document.getElementById('patientName') ? document.getElementById('patientName').value : '',
        ageSex: document.getElementById('ageSex') ? document.getElementById('ageSex').value : '',
        patientId: document.getElementById('patientId') ? document.getElementById('patientId').value : '',
        assessmentDate: document.getElementById('assessmentDate') ? document.getElementById('assessmentDate').value : '',
        complaints: document.getElementById('complaints') ? document.getElementById('complaints').value : '',
        pastHistory: document.getElementById('pastHistory') ? document.getElementById('pastHistory').value : '',
        additionalPoints: document.getElementById('additionalPoints') ? document.getElementById('additionalPoints').value : '',
        referredBy: document.getElementById('referredBy') ? document.getElementById('referredBy').value : ''
    };
}

function updatePillarButtons() {
    const pillars = ['agni', 'dosha', 'dhatu', 'srotas'];
    
    pillars.forEach((pillar, index) => {
        const btn = document.getElementById(pillar + '-btn');
        
        if (!btn) return;
        
        if (assessmentData.completed[pillar]) {
            // Mark as completed
            btn.classList.remove('available', 'locked');
            btn.classList.add('completed');
        } else if (index === 0 || assessmentData.completed[pillars[index - 1]]) {
            // Make available if first pillar or previous is completed
            btn.classList.remove('locked', 'completed');
            btn.classList.add('available');
        } else {
            // Keep locked
            btn.classList.remove('available', 'completed');
            btn.classList.add('locked');
        }
    });
}

// -------------------- Progress and final report integration --------------------
function updateProgress() {
    const completed = Object.values(assessmentData.completed).filter(Boolean).length;
    const progressPercent = (completed / 4) * 100;
    
    const pf = document.getElementById('progressFill');
    if (pf) pf.style.width = progressPercent + '%';
    
    const statusDiv = document.getElementById('completionStatus');
    if (!statusDiv) return;
    if (completed === 4) {
        statusDiv.className = 'status-message status-success';
        statusDiv.innerHTML = '<strong>üéâ All Assessments Complete!</strong> Click below to view your comprehensive report.';
        statusDiv.style.display = 'block';
        
        // Add final report button if not present
        if (!document.getElementById('final-report-btn')) {
            const reportBtn = document.createElement('button');
            reportBtn.id = 'final-report-btn';
            reportBtn.className = 'btn btn-primary';
            reportBtn.style.margin = '15px auto';
            reportBtn.style.display = 'block';
            reportBtn.innerHTML = 'üìã Generate Final Report';
            reportBtn.onclick = () => showPage('report-page');
            statusDiv.appendChild(reportBtn);
        }
    } else if (completed > 0) {
        statusDiv.className = 'status-message status-info';
        statusDiv.innerHTML = `<strong>Progress:</strong> ${completed}/4 assessments completed. Continue with the next available pillar.`;
        statusDiv.style.display = 'block';
    } else {
        statusDiv.style.display = 'none';
    }
}

function checkAllComplete() {
    const allComplete = Object.values(assessmentData.completed).every(Boolean);
    if (allComplete) {
        updateProgress();
        generateFinalReport();
    }
}

function generateFinalReport() {
    const reportContent = `
        <div class="patient-info" style="background: #f9f9f9; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
            <h4>Patient Information</h4>
            <p><strong>Name:</strong> ${assessmentData.patient.name}</p>
            <p><strong>Age/Sex:</strong> ${assessmentData.patient.ageSex}</p>
            <p><strong>Date:</strong> ${assessmentData.patient.assessmentDate}</p>
            <p><strong>Chief Complaints:</strong> ${assessmentData.patient.complaints}</p>
        </div>
        
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px;">
            <div class="pillar-summary">
                <p>Vishama: ${assessmentData.agni.vishama} | Tikshna: ${assessmentData.agni.tikshna}</p>
                <p>Manda: ${assessmentData.agni.manda} | Sama: ${assessmentData.agni.sama}</p>
                <p>Total Dusti: ${assessmentData.agni.vishama + assessmentData.agni.tikshna + assessmentData.agni.manda}/8</p>
            </div>
            
            <div class="pillar-summary">
                <h5>‚öñÔ∏è Dosha Assessment</h5>
                <p>Vata: ${assessmentData.dosha.vata}/20</p>
                <p>Pitta: ${assessmentData.dosha.pitta}/20</p>
                <p>Kapha: ${assessmentData.dosha.kapha}/20</p>
            </div>
            
            <div class="pillar-summary">
                <h5>üß¨ Dhatu Assessment</h5>
                <p><em>Framework completed</em></p>
                <p>Ready for detailed implementation</p>
            </div>
            
            <div class="pillar-summary">
                <h5>üåä Srotas Assessment</h5>
                <p><em>Framework completed</em></p>
                <p>Ready for detailed implementation</p>
            </div>
        </div>
        
        <div style="margin-top: 30px; padding: 20px; background: #e8f4fd; border-radius: 10px;">
            <h4>Clinical Summary</h4>
            <p>This comprehensive 4-pillar assessment provides a systematic evaluation of the patient's constitutional state and pathological patterns according to classical Ayurvedic principles.</p>
            <p><strong>Recommendations:</strong> Based on the assessment results, appropriate treatment protocols can be designed focusing on the dominant imbalances identified.</p>
        </div>
    `;
    
    const sr = document.getElementById('summary-results');
    if (sr) sr.innerHTML = reportContent;
}

// -------------------- Print and export functions --------------------
function printFinalReport() {
    const printContent = generatePrintableReport();
    const printWindow = window.open('', '_blank');
    
    printWindow.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
            <title>4-Pillar Ayurvedic Assessment Report</title>
            <style>
                body { 
                    font-family: Arial, sans-serif; 
                    margin: 20px; 
                    line-height: 1.6; 
                }
                .header { 
                    text-align: center; 
                    border-bottom: 3px solid #333; 
                    padding-bottom: 20px; 
                    margin-bottom: 30px; 
                }
                .section { 
                    margin-bottom: 25px; 
                    page-break-inside: avoid;
                }
                .section h3 { 
                    background: #f0f0f0; 
                    padding: 10px; 
                    margin: 0 0 15px 0; 
                    border-left: 5px solid #667eea;
                }
                .patient-info { 
                    background: #f9f9f9; 
                    padding: 15px; 
                    border: 1px solid #ddd; 
                    border-radius: 5px;
                }
                .score-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 15px;
                    margin: 15px 0;
                }
                .score-item {
                    background: #f8f9fa;
                    padding: 10px;
                    border-radius: 5px;
                    border: 1px solid #dee2e6;
                }
                .summary {
                    background: #e8f4fd;
                    padding: 20px;
                    border-radius: 5px;
                    margin-top: 20px;
                }
                @media print {
                    .no-print { display: none; }
                    body { margin: 0; }
                }
            </style>
        </head>
        <body>
            ${printContent}
        </body>
        </html>
    `);
    
    printWindow.document.close();
    setTimeout(() => printWindow.print(), 500);
}

function generatePrintableReport() {
    const patient = assessmentData.patient;
    const agniTotal = assessmentData.agni.vishama + assessmentData.agni.tikshna + assessmentData.agni.manda;
    
    return `
        <div class="header">
            <h1>4-PILLAR AYURVEDIC ASSESSMENT REPORT</h1>
            <p><strong>Dr. Prakash Kumbar</strong></p>
            <p>Date of Assessment: ${patient.assessmentDate || new Date().toLocaleDateString()}</p>
        </div>
        
        <div class="section">
            <h3>üìã Patient Information</h3>
            <div class="patient-info">
                <div class="score-grid">
                    <div><strong>Name:</strong> ${patient.name || 'N/A'}</div>
                    <div><strong>Age/Sex:</strong> ${patient.ageSex || 'N/A'}</div>
                    <div><strong>Patient ID:</strong> ${patient.patientId || 'N/A'}</div>
                    <div><strong>Referred By:</strong> ${patient.referredBy || 'N/A'}</div>
                </div>
                <p><strong>Chief Complaints:</strong> ${patient.complaints || 'N/A'}</p>
                <p><strong>Past History:</strong> ${patient.pastHistory || 'N/A'}</p>
                <p><strong>Additional Points:</strong> ${patient.additionalPoints || 'N/A'}</p>
            </div>
        </div>
        
        <div class="section">
            <h3>üî• PILLAR 1: Agni Dusti Assessment</h3>
            <div class="score-grid">
                <div class="score-item">
                    <strong>Vishama Agni (Vata):</strong> ${assessmentData.agni.vishama}
                </div>
                <div class="score-item">
                    <strong>Tikshna Agni (Pitta):</strong> ${assessmentData.agni.tikshna}
                </div>
                <div class="score-item">
                    <strong>Manda Agni (Kapha):</strong> ${assessmentData.agni.manda}
                </div>
                <div class="score-item">
                    <strong>Sama Agni (Balanced):</strong> ${assessmentData.agni.sama}
                </div>
            </div>
            <p><strong>Total Dusti Score:</strong> ${agniTotal}/8</p>
            <p><strong>Assessment:</strong> ${getSeverityText(agniTotal, 'agni')}</p>
        </div>
        
        <div class="section">
            <h3>‚öñÔ∏è PILLAR 2: Dosha Dusti Assessment</h3>
            <div class="score-grid">
                <div class="score-item">
                    <strong>Vata Dosha:</strong> ${assessmentData.dosha.vata}/20<br>
                    <small>${getDoshaSeverityText(assessmentData.dosha.vata)}</small>
                </div>
                <div class="score-item">
                    <strong>Pitta Dosha:</strong> ${assessmentData.dosha.pitta}/20<br>
                    <small>${getDoshaSeverityText(assessmentData.dosha.pitta)}</small>
                </div>
                <div class="score-item">
                    <strong>Kapha Dosha:</strong> ${assessmentData.dosha.kapha}/20<br>
                    <small>${getDoshaSeverityText(assessmentData.dosha.kapha)}</small>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h3>üß¨ PILLAR 3: Dhatu Dusti Assessment</h3>
            <p><em>Framework Assessment Completed</em></p>
            <p>Detailed evaluation of all 7 dhatus (Rasa, Rakta, Mamsa, Meda, Asthi, Majja, Shukra) for both Kshaya and Vriddhi symptoms.</p>
        </div>
        
        <div class="section">
            <h3>üåä PILLAR 4: Sroto Dusti Assessment</h3>
            <p><em>Framework Assessment Completed</em></p>
            <p>Systematic evaluation of all 9 srotas based on classical lakshanas of dushti.</p>
        </div>
        
        <div class="summary">
            <h3>üìä Clinical Summary & Recommendations</h3>
            <p><strong>Assessment Overview:</strong> This comprehensive 4-pillar assessment provides a systematic evaluation of the patient's constitutional state and pathological patterns according to classical Ayurvedic principles.</p>
            
            <p><strong>Key Findings:</strong></p>
            <ul>
                <li>Agni Assessment: ${getSeverityText(agniTotal, 'agni')}</li>
                <li>Dominant Dosha: ${getDominantDosha()}</li>
                <li>Constitutional Pattern: Based on current imbalances</li>
            </ul>
            
            <p><strong>Recommendations:</strong> Treatment protocols should focus on balancing the identified imbalances through appropriate Panchakarma procedures, dietary modifications, lifestyle changes, and herbal formulations as per classical Ayurvedic guidelines.</p>
            
            <p><strong>Follow-up:</strong> Regular monitoring and reassessment recommended to track progress and adjust treatment as needed.</p>
        </div>
        
        <div style="margin-top: 40px; text-align: center; font-size: 12px; color: #666;">
            <p>Generated by 4-Pillar Ayurvedic Assessment System | Dr. Prakash Kumbar</p>
            <p>This report is based on classical Ayurvedic assessment methods and should be interpreted by qualified practitioners.</p>
        </div>
    `;
}

/* Helper functions used by printable report */
function getSeverityText(score, type) {
    if (type === 'agni') {
        if (score === 0) return 'Sama Agni (Balanced digestive fire)';
        if (score <= 4) return 'Mild Agni Dusti (Minor digestive imbalance)';
        if (score <= 6) return 'Moderate Agni Dusti (Significant digestive issues)';
        return 'Severe Agni Dusti (Major digestive dysfunction)';
    }
    return 'Assessment completed';
}

function getDoshaSeverityText(score) {
    if (score <= 4) return 'No significant dushti';
    if (score <= 9) return 'Mild dushti';
    if (score <= 14) return 'Moderate dushti';
    if (score <= 20) return 'Severe dushti';
    return 'Assessment incomplete';
}

function getDominantDosha() {
    const doshas = ['vata', 'pitta', 'kapha'];
    let maxScore = 0;
    let dominant = 'Balanced';
    
    doshas.forEach(dosha => {
        if (assessmentData.dosha[dosha] > maxScore) {
            maxScore = assessmentData.dosha[dosha];
            dominant = dosha.charAt(0).toUpperCase() + dosha.slice(1);
        }
    });
    
    return maxScore > 0 ? `${dominant} (Score: ${maxScore})` : 'Balanced state';
}

// -------------------- Save / Export / Import / Restore functionality --------------------
function saveAssessmentData() {
    savePatientData();
    
    const fullAssessment = {
        timestamp: new Date().toISOString(),
        patient: assessmentData.patient,
        assessments: {
            agni: {
                scores: assessmentData.agni,
                total: assessmentData.agni.vishama + assessmentData.agni.tikshna + assessmentData.agni.manda,
                completed: assessmentData.completed.agni
            },
            dosha: {
                scores: assessmentData.dosha,
                completed: assessmentData.completed.dosha
            },
            dhatu: {
                completed: assessmentData.completed.dhatu
            },
            srotas: {
                completed: assessmentData.completed.srotas
            }
        },
        selections: assessmentData.selections
    };
    
    // Validate required fields
    if (!assessmentData.patient.name || !assessmentData.patient.ageSex || !assessmentData.patient.complaints) {
        alert('Please fill in all required patient information fields.');
        return false;
    }
    
    const assessmentJSON = JSON.stringify(fullAssessment, null, 2);
    const blob = new Blob([assessmentJSON], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${assessmentData.patient.name.replace(/\s+/g, '_')}_4Pillar_Assessment_${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    alert('Assessment data saved successfully!');
    return true;
}

function importAssessment() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    
                    if (importedData.patient && importedData.assessments) {
                        if (confirm(`Import assessment data for ${importedData.patient.name}?\n\nThis will overwrite current data.`)) {
                            assessmentData.patient = importedData.patient;
                            assessmentData.agni = importedData.assessments.agni.scores;
                            assessmentData.dosha = importedData.assessments.dosha.scores;
                            assessmentData.completed = {
                                agni: importedData.assessments.agni.completed,
                                dosha: importedData.assessments.dosha.completed,
                                dhatu: importedData.assessments.dhatu.completed,
                                srotas: importedData.assessments.srotas.completed
                            };
                            assessmentData.selections = importedData.selections || {};
                            
                            // Update form fields
                            if (document.getElementById('patientName')) document.getElementById('patientName').value = assessmentData.patient.name || '';
                            if (document.getElementById('ageSex')) document.getElementById('ageSex').value = assessmentData.patient.ageSex || '';
                            if (document.getElementById('patientId')) document.getElementById('patientId').value = assessmentData.patient.patientId || '';
                            if (document.getElementById('assessmentDate')) document.getElementById('assessmentDate').value = assessmentData.patient.assessmentDate || '';
                            if (document.getElementById('complaints')) document.getElementById('complaints').value = assessmentData.patient.complaints || '';
                            if (document.getElementById('pastHistory')) document.getElementById('pastHistory').value = assessmentData.patient.pastHistory || '';
                            if (document.getElementById('additionalPoints')) document.getElementById('additionalPoints').value = assessmentData.patient.additionalPoints || '';
                            if (document.getElementById('referredBy')) document.getElementById('referredBy').value = assessmentData.patient.referredBy || '';
                            
                            // Re-inject dosha buttons in case they were not present yet
                            injectDoshaSeverityButtons();
                            
                            // Restore visual selections
                            restoreSelections();
                            
                            // Update displays
                            updatePillarButtons();
                            updateProgress();
                            updateAgniDisplay();
                            updateDoshaDisplay();
                            
                            alert('Assessment data imported successfully!');
                        }
                    } else {
                        alert('Invalid file format. Please select a valid assessment file.');
                    }
                } catch (error) {
                    alert('Error reading file. Please check the file format.');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
        }
    };
    input.click();
}

function restoreSelections() {
    // Restore visual selections based on saved selections
    Object.keys(assessmentData.selections).forEach(key => {
        const value = assessmentData.selections[key];
        
        if (key.startsWith('agni_')) {
            const parameter = key.replace('agni_', '');
            const cell = document.querySelector(`[data-pillar="agni"][data-parameter="${parameter}"][data-type="${value}"]`);
            if (cell) cell.classList.add('selected');
        } else if (key.startsWith('dosha_')) {
            // key format: dosha_<dosha>_<parameter>
            const parts = key.split('_');
            if (parts.length >= 3) {
                const dosha = parts[1];
                const parameter = parts.slice(2).join('_');
                // find the td for this dosha/parameter
                const td = document.querySelector(`[data-dosha="${dosha}"][data-parameter="${parameter}"]`);
                if (td) {
                    // ensure controls injected
                    injectDoshaSeverityButtons();
                    // find button with matching score value
                    const btn = td.querySelector(`.dosha-severity-btn[data-score="${value}"]`);
                    if (btn) {
                        // simulate selection visuals without re-processing logic (we must update assessmentData.dosha too)
                        td.querySelectorAll('.dosha-severity-btn').forEach(b => b.classList.remove('severity-selected'));
                        btn.classList.add('severity-selected');
                        btn.style.outline = '3px solid rgba(102,126,234,0.25)';
                        td.classList.add('selected');
                    }
                }
            }
        }
    });

    // After restoring visuals, recalc dosha totals from assessmentData.selections
    // (use the existing selections object)
    // Reset totals
    assessmentData.dosha = { vata: 0, pitta: 0, kapha: 0 };
    Object.keys(assessmentData.selections).forEach(k => {
        if (k.startsWith('dosha_')) {
            const parts = k.split('_');
            const dosha = parts[1];
            const param = parts.slice(2).join('_');
            const val = Number(assessmentData.selections[k]);
            if (!isNaN(val)) {
                assessmentData.dosha[dosha] = (assessmentData.dosha[dosha] || 0) + val;
            }
        }
    });

    // Update displays once restored
    updateDoshaDisplay();
    checkDoshaCompletion();
}

// -------------------- Keyboard shortcuts --------------------
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey && e.key === 's') {
        e.preventDefault();
        saveAssessmentData();
    }
    if (e.ctrlKey && e.key === 'p') {
        const currentPage = document.querySelector('.page.active') ? document.querySelector('.page.active').id : '';
        if (currentPage === 'report-page') {
            e.preventDefault();
            printFinalReport();
        }
    }
    if (e.key === 'Escape') {
        goToMain();
    }
});

// -------------------- Auto-save (in-memory/localStorage) --------------------
let autoSaveTimer;
function startAutoSave() {
    clearTimeout(autoSaveTimer);
    autoSaveTimer = setTimeout(() => {
        if (assessmentData.patient && assessmentData.patient.name) {
            localStorage.setItem('ayurveda_assessment_autosave', JSON.stringify(assessmentData));
        }
    }, 30000); // 30s
}

function restoreAutoSaved() {
    const autoSaved = localStorage.getItem('ayurveda_assessment_autosave');
    if (autoSaved) {
        try {
            const saved = JSON.parse(autoSaved);
            if (saved && saved.patient && saved.patient.name) {
                if (confirm(`Found auto-saved data for ${saved.patient.name}. Would you like to restore it?`)) {
                    assessmentData = saved;
                    // re-inject controls and restore visuals/selections
                    injectDoshaSeverityButtons();
                    restoreSelections();
                    updatePillarButtons();
                    updateProgress();
                    updateAgniDisplay();
                    updateDoshaDisplay();
                }
            }
        } catch (e) {
            console.log('Could not restore auto-saved data');
        }
    }
}

// Trigger autosave on input/click
document.addEventListener('input', startAutoSave);
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('clickable-cell') || e.target.classList.contains('dosha-severity-btn')) {
        startAutoSave();
    }
});

// -------------------- Reset functions --------------------
function resetAllAssessments() {
    if (confirm('‚ö†Ô∏è Are you sure you want to reset ALL assessment data?\n\nThis will permanently delete:\n‚Ä¢ All patient information\n‚Ä¢ All assessment scores\n‚Ä¢ All selections\n\nThis action cannot be undone!')) {
        assessmentData = {
            patient: {},
            agni: { vishama: 0, tikshna: 0, manda: 0, sama: 0 },
            dosha: { vata: 0, pitta: 0, kapha: 0 },
            dhatu: {},
            srotas: {},
            selections: {},
            completed: { agni: false, dosha: false, dhatu: false, srotas: false }
        };
        
        // Clear all form inputs
        document.querySelectorAll('input, textarea').forEach(input => { input.value = ''; });
        
        // Reset date to today
        const d = document.getElementById('assessmentDate');
        if (d) d.valueAsDate = new Date();
        
        // Remove all selections visuals and severity buttons
        document.querySelectorAll('.clickable-cell').forEach(cell => cell.classList.remove('selected'));
        document.querySelectorAll('.dosha-severity-btn').forEach(b => {
            b.classList.remove('severity-selected');
            b.style.outline = 'none';
        });
        
        // Reset displays
        updateAgniDisplay();
        updateDoshaDisplay();
        
        // Clear result displays
        const agniRes = document.getElementById('agni-results');
        if (agniRes) agniRes.innerHTML = 'Complete the assessment to see results...';
        const doshaRes = document.getElementById('dosha-results');
        if (doshaRes) doshaRes.innerHTML = 'Complete Vata assessment first, then Pitta and Kapha will appear...';
        const dhatuRes = document.getElementById('dhatu-results');
        if (dhatuRes) dhatuRes.innerHTML = 'Dhatu assessment framework ready for implementation...';
        const srotasRes = document.getElementById('srotas-results');
        if (srotasRes) srotasRes.innerHTML = 'Srotas assessment framework ready for implementation...';
        
        updatePillarButtons();
        updateProgress();
        goToMain();
        
        setTimeout(() => alert('‚úÖ All assessment data has been reset successfully!'), 300);
    }
}

function resetCurrentPillar() {
    const currentPage = document.querySelector('.page.active') ? document.querySelector('.page.active').id : '';
    const pillar = currentPage.replace('-page', '');
    if (!pillar) return;
    if (!confirm(`Reset ${pillar.toUpperCase()} assessment data?`)) return;

    if (pillar === 'agni') {
        // Reset agni-specific
        Object.keys(assessmentData.selections).forEach(key => {
            if (key.startsWith('agni_')) delete assessmentData.selections[key];
        });
        assessmentData.agni = { vishama: 0, tikshna: 0, manda: 0, sama: 0 };
        document.querySelectorAll('[data-pillar="agni"]').forEach(c => c.classList.remove('selected'));
        updateAgniDisplay();
        checkAgniCompletion();
    } else if (pillar === 'dosha') {
        Object.keys(assessmentData.selections).forEach(key => {
            if (key.startsWith('dosha_')) delete assessmentData.selections[key];
        });
        assessmentData.dosha = { vata: 0, pitta: 0, kapha: 0 };
        document.querySelectorAll('[data-dosha]').forEach(td => {
            td.classList.remove('selected');
            td.querySelectorAll('.dosha-severity-btn').forEach(b => {
                b.classList.remove('severity-selected');
                b.style.outline = 'none';
            });
        });
        updateDoshaDisplay();
        checkDoshaCompletion();
    }
    assessmentData.completed[pillar] = false;
    updatePillarButtons();
    updateProgress();
    alert(`${pillar.toUpperCase()} assessment has been reset.`);
}

// -------------------- End of script logs --------------------
console.log("‚úÖ 4-Pillar Assessment System - Enhanced script loaded successfully!");
console.log("üîß Dosha D≈´·π£·π≠i now has severity buttons (0/1/2) injected dynamically and integrated with existing flow.");
</script>

</body>
</html>
